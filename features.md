# Alter0 Features（OpenClaw 对齐版，2026-03）

## 0. 文档定位

- 本文只保留"未完成"的新需求，不再重复已交付能力。
- 已完成能力矩阵请看 `docs/features.md`。
- 目标是让 Alter0 从"单机任务编排内核"升级到"可多通道、多 Agent、可主动触达"的网关内核。

## 1. 约束与阶段目标

- 部署形态：继续保持自部署优先，先做单节点高可用，再考虑分布式扩展。
- 安全边界：默认私有网络可用，但新增能力必须带最小可行的权限控制与审计。
- 兼容策略：保留现有 Task 编排主链路（route -> execute -> close），新增能力以可插拔方式接入。
- 阶段目标：对齐 OpenClaw 的核心网关能力（多通道、会话编排、子代理、主动消息、节点能力、记忆检索）。

## 2. 新需求列表（仅未完成项）

### 2.1 多通道网关模型（N1）

#### 目标

- 从 CLI/HTTP/Web 三通道扩展为可插拔的消息网关。

#### 需求点

- 设计 Channel Adapter V2：统一 inbound/outbound message envelope（文本、图片、音频、文件、引用回复）。
- 支持多账号实例化（同一 channel 下多个 account）与路由绑定（channel + account + peer -> agent）。
- 增加群聊治理策略：`allowlist/denylist`、`requireMention`、按群配置开关。
- 增加通道健康状态与重连状态机，统一暴露到 `/api/status`。

#### 验收标准

- 至少 2 种外部聊天通道可稳定收发消息（含媒体消息）。
- 同一进程内可并行运行多账号，不发生会话串扰。

### 2.2 多 Agent 与会话编排模型（N2）

#### 目标

- 支持一个网关下多个隔离 Agent（独立 workspace、独立 session store）。

#### 需求点

- 建立 Agent Registry（`agentId/workspace/agentDir`）与默认 Agent 回退策略。
- 增加会话工具能力：会话列表、会话历史、跨会话发送、会话状态查询。
- 实现子代理运行模型（spawn run/session 两种模式），支持超时、清理、结果回传。
- 增加会话压缩与 TTL 归档策略，控制长会话成本与上下文膨胀。

#### 验收标准

- 同时运行多个 Agent 时，历史、工具权限、输出通道完全隔离。
- 子代理任务可并发执行并自动向主会话回报结果。

### 2.3 主动触达与定时任务模型（N3）

#### 目标

- 支持"不等用户发消息"的主动执行与提醒投递。

#### 需求点

- 增加统一计划任务中心：一次性任务（at）+ 周期任务（cron）。
- 支持 `agentTurn` 负载执行并直接投递到指定 channel/to。
- 增加任务幂等键与重试策略，避免重复提醒或丢提醒。
- 提供任务查询、暂停、取消、最近执行记录接口与控制台视图。

#### 验收标准

- at/cron 任务在网关重启后可恢复。
- 定时触达成功率与失败重试路径可观测、可审计。

### 2.4 工具体系扩展模型（N4）

#### 目标

- 从"执行器调用"升级到"网关级工具编排"。

#### 需求点

- 补齐通用工具协议：`web_search/web_fetch/browser/canvas/nodes/message/tts`。
- 增加工具权限策略（全局 + agent 级 allow/deny），并支持危险工具二次确认。
- 统一工具结果结构（成功、失败、可重试、结构化错误码）。
- 增加工具执行审计链路（请求参数摘要、耗时、结果摘要、调用来源会话）。

#### 验收标准

- 新工具可被执行器稳定调用，失败路径有一致错误语义。
- 关键高风险工具默认受控，不可被无约束调用。

### 2.5 记忆与上下文治理模型（N5）

#### 目标

- 建立"短期会话 + 长期记忆"双层记忆体系。

#### 需求点

- 增加长期记忆检索接口（语义搜索 + 片段读取），支持 MEMORY/daily memory 两层存储。
- 增加"先检索再回答"策略钩子（涉及历史决策/日期/待办时自动触发）。
- 增加场景隔离策略：主会话可读完整长期记忆，群聊默认只读安全子集。
- 增加记忆维护任务：归档、去重、过期清理、冲突标注。

#### 验收标准

- 涉及历史问题时命中率可量化，且可给出可追溯来源。
- 敏感记忆不会跨会话、跨用户泄露。

### 2.6 控制面与可观测模型（N6）

#### 目标

- 提供接近 OpenClaw 的运维控制面与诊断体验。

#### 需求点

- Web Console 增加会话管理、子代理管理、定时任务管理、节点状态面板。
- `/status` 与 `/api/status` 增加模型用量、token、成本、子任务并发等统计。
- 增加端到端追踪（inbound -> route -> tool -> executor -> deliver）。
- 增加关键告警（队列积压、通道断连、重试风暴、执行器不可用）。

#### 验收标准

- 常见故障可在 10 分钟内定位到具体模块与请求链路。
- 控制台可完成"观测 -> 处置 -> 验证"闭环。

### 2.7 安全与策略治理模型（N7）

#### 目标

- 在保持易用性的前提下，建立可落地的最小安全治理。

#### 需求点

- 按 channel/account/peer 维度实现访问策略与来源限制。
- 增加高风险操作保护（命令 denylist、外发确认、敏感路径保护）。
- 增加配置安全体检（危险配置提示、沙箱偏差提示、权限过宽提示）。
- 增加安全审计日志视图与导出能力。

#### 验收标准

- 默认配置对误操作有防护，不影响核心链路可用性。
- 安全事件可追踪、可复盘。

### 2.8 交付与回归模型（N8）

#### 目标

- 让新增能力可以持续交付，不破坏现有稳定性。

#### 需求点

- 建立网关级集成测试矩阵（多通道、多 Agent、子代理、定时任务、工具调用）。
- 增加重启恢复与故障注入测试（断网、执行器崩溃、数据库锁冲突）。
- 增加 OpenClaw 能力对齐清单（按版本追踪新增能力与缺口）。
- 建立发布门禁：功能回归、迁移演练、回滚演练、文档同步。

#### 验收标准

- `go test ./...` + 核心集成用例稳定通过。
- 每次发布具备可执行的升级与回滚路径。

## 3. 优先级与执行队列（新）

### P0（网关化基础）

1. N1 多通道网关模型（先打通 2 个外部通道）
2. N2 多 Agent Registry + 会话隔离
3. N3 at/cron 计划任务 + 指定通道投递
4. N6 状态面扩展（会话/子代理/计划任务/成本）

### P1（编排能力增强）

1. N2 子代理 run/session 模式 + 结果回传
2. N4 工具协议与权限治理
3. N5 长期记忆检索与场景隔离
4. N7 安全策略与风险体检

### P2（高级能力与体验收口）

1. N4 节点/浏览器/Canvas 深度工具链
2. N6 告警与端到端追踪完善
3. N8 完整回归矩阵与发布门禁自动化

## 4. 执行规则

- 单需求闭环：每次只推进一个需求到"编码 + 测试 + 文档"完成态。
- 文档同步：需求状态变化后，必须同步 `docs/features.md` 的能力矩阵与活跃队列。
- 变更可回滚：涉及存储、会话、任务调度的改动必须附带回滚说明。
