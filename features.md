# Alter0 Features（OpenClaw 对齐版，2026-03）

## 0. 文档定位

- 本文只保留"未完成"的新需求，不再重复已交付能力。
- 已完成能力矩阵请看 `docs/features.md`。
- OpenClaw 版本对齐清单请看 `docs/openclaw-alignment.md`。

## 1. 约束与阶段目标

- 部署形态：继续保持自部署优先，先做单节点高可用，再考虑分布式扩展。
- 安全边界：默认私有网络可用，但新增能力必须带最小可行的权限控制与审计。
- 兼容策略：保留现有 Task 编排主链路（route -> execute -> close），新增能力以可插拔方式接入。
- 阶段目标：对齐 OpenClaw 的核心网关能力（多通道、会话编排、子代理、主动消息、节点能力、记忆检索）。

## 2. 新需求列表（仅未完成项）

### N9 异步任务取消语义修复（P0）

- 目标：`POST /api/tasks/{id}/cancel` 需要具备真实中断能力，而非仅状态标记。
- 交付边界：
  - 为异步任务引入可追踪取消句柄，pending/running 均可中断。
  - 被取消任务不得继续写入 completed 结果，不得继续执行外部副作用步骤。
  - 状态机补齐 canceled 终态审计与可观测字段。

### N10 存储迁移安全升级（P0）

- 目标：替换 destructive reset，落地可回滚的版本化迁移链路。
- 交付边界：
  - schema 迁移改为增量、非破坏执行。
  - 启动流程强制 backup-before-migration，并提供失败回退路径。
  - 对历史库升级补齐兼容验证与回归用例。

### N11 HTTP 层职责收敛（P1）

- 目标：削减 `interaction/http` 中的业务编排状态，恢复传输适配层定位。
- 交付边界：
  - async/subagent/schedule 的核心状态与生命周期下沉到 `app/core` 能力模块。
  - HTTP 层仅保留协议解析、鉴别、响应组装与错误映射。
  - 统一接口契约，保持现有 API 兼容。

### N12 调度能力边界统一（P1）

- 目标：消除 `scheduler` 与 `schedule.Service` 双调度循环带来的职责重叠。
- 交付边界：
  - 明确“通用作业调度”与“业务投递调度”唯一调度主循环。
  - 统一运行态指标与告警口径，避免重复统计与冲突状态。
  - 提供迁移期兼容方案与停机切换步骤。

### N13 配置层依赖解耦（P1）

- 目标：移除 `configs -> core/tools` 反向依赖，恢复分层依赖方向。
- 交付边界：
  - 规范化能力下沉至 `pkg` 或独立 `policy` 组件。
  - `configs` 仅依赖基础类型与通用工具，不直接引用 runtime 实现包。
  - 保持现有配置文件语义与默认值兼容。

### N14 测试稳定性加固（P0）

- 目标：清理当前波动用例，恢复 `go test ./...` 稳定通过。
- 交付边界：
  - 修复 scheduler 时长断言抖动与 sqlite 锁测试清理异常。
  - 增加 Windows 环境稳定性回归验证。
  - 作为 release-gate 前置条件纳入检查。

## 3. 优先级与执行队列（新）

### P0（立即处理）

1. [ ] N9 异步任务取消语义修复（真实中断 + 状态一致性）
2. [ ] N10 存储迁移安全升级（非破坏迁移 + 备份回滚）
3. [ ] N14 测试稳定性加固（全量测试稳定通过）

### P1（结构优化）

1. [ ] N11 HTTP 层职责收敛（状态下沉与编排解耦）
2. [ ] N12 调度能力边界统一（单一调度主循环）
3. [ ] N13 配置层依赖解耦（移除反向依赖）

## 4. 执行规则

- 单需求闭环：每次只推进一个需求到"编码 + 测试 + 文档"完成态。
- 文档同步：需求状态变化后，必须同步 `docs/features.md` 的能力矩阵与活跃队列。
- 变更可回滚：涉及存储、会话、任务调度的改动必须附带回滚说明。
